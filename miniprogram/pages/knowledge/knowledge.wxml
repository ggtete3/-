<!--pages/knowledge/knowledge.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input">
      <text class="search-icon">ğŸ”</text>
      <input 
        placeholder="æœç´¢ç¯ä¿çŸ¥è¯†..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
    </view>
  </view>

  <!-- çŸ¥è¯†åˆ†ç±» -->
  <view class="category-tabs">
    <scroll-view scroll-x="true" class="tabs-scroll">
      <view class="tabs-list">
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="tab-item {{currentCategory === item.id ? 'active' : ''}}"
          bindtap="switchCategory"
          data-id="{{item.id}}"
        >
          <text class="tab-icon">{{item.icon}}</text>
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¯æ—¥ç­”é¢˜å¡ç‰‡ -->
  <view class="daily-quiz" bindtap="goToQuiz">
    <view class="quiz-header">
      <text class="quiz-title">æ¯æ—¥ç­”é¢˜</text>
      <text class="quiz-status">{{quizStatus}}</text>
    </view>
    <text class="quiz-desc">ç­”é¢˜è·ç§¯åˆ†ï¼Œå­¦ä¹ ç¯ä¿çŸ¥è¯†</text>
    <view class="quiz-stats">
      <text class="quiz-streak">è¿ç»­ç­”é¢˜ {{streakDays}} å¤©</text>
      <text class="quiz-points">+{{quizPoints}} ç§¯åˆ†</text>
    </view>
  </view>

  <!-- æ¨èæ–‡ç«  -->
  <view class="featured-section" wx:if="{{featuredArticles.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ¨èé˜…è¯»</text>
    </view>
    <scroll-view scroll-x="true" class="featured-scroll">
      <view class="featured-list">
        <view 
          wx:for="{{featuredArticles}}" 
          wx:key="id"
          class="featured-item"
          bindtap="goToArticle"
          data-id="{{item.id}}"
        >
          <image src="{{item.cover_image}}" class="featured-image" mode="aspectFill" />
          <view class="featured-content">
            <text class="featured-title">{{item.title}}</text>
            <text class="featured-summary">{{item.summary}}</text>
            <view class="featured-meta">
              <text class="read-count">{{item.read_count}} é˜…è¯»</text>
              <text class="publish-date">{{formatDate(item.created_at)}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- çŸ¥è¯†æ–‡ç« åˆ—è¡¨ -->
  <view class="articles-section">
    <view class="section-header">
      <text class="section-title">çŸ¥è¯†æ–‡ç« </text>
      <view class="sort-options">
        <text 
          class="sort-item {{sortType === 'latest' ? 'active' : ''}}"
          bindtap="changeSortType"
          data-type="latest"
        >æœ€æ–°</text>
        <text 
          class="sort-item {{sortType === 'popular' ? 'active' : ''}}"
          bindtap="changeSortType"
          data-type="popular"
        >çƒ­é—¨</text>
      </view>
    </view>

    <view class="articles-list">
      <view 
        wx:for="{{articles}}" 
        wx:key="id"
        class="article-item"
        bindtap="goToArticle"
        data-id="{{item.id}}"
      >
        <image src="{{item.cover_image}}" class="article-image" mode="aspectFill" />
        <view class="article-content">
          <text class="article-title">{{item.title}}</text>
          <text class="article-summary">{{item.summary}}</text>
          <view class="article-meta">
            <view class="meta-left">
              <text class="author">{{item.author}}</text>
              <text class="publish-date">{{formatDate(item.created_at)}}</text>
            </view>
            <view class="meta-right">
              <text class="read-count">{{item.read_count}} é˜…è¯»</text>
              <text class="like-count">â¤ï¸ {{item.like_count}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <button class="load-more-btn" bindtap="loadMore" loading="{{loading}}">
        {{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
      </button>
    </view>

    <!-- æ— æ›´å¤šå†…å®¹ -->
    <view class="no-more" wx:if="{{!hasMore && articles.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šå†…å®¹äº†</text>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{articles.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— ç›¸å…³çŸ¥è¯†å†…å®¹</text>
    <button class="refresh-btn" bindtap="refreshData">åˆ·æ–°é‡è¯•</button>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view> 